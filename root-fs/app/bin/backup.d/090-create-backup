#!/bin/bash
if [[  $(restic -r /data/backup/ cat config <<< ${BACKUP_PASS} > /dev/null 2>&1 ) ]]; then
	restic -r /data/backup/ backup /data --exclude-file=/app/bin/backup.d/conf/restic_excludes.txt <<< ${BACKUP_PASS} > /proc/1/fd/1 2>&1 ;
else
	TIMESTAMP=`date +%Y-%m-%d_%H-%M-%S`
	mkdir -p /data/backup/${WIKI_HOST}_${TIMESTAMP}	
	for f in /data/*; do
	if [[ -d "$f" ]] && [[ "$f" != "data/backup" ]] && [[ "$f" != "data/database" ]] && [[ "$f" != "data/database-collabpads" ]] && [[ "$f" != "data/search" ]] ; then
		echo ""
		echo "ðŸ”§ Backing up $f"
		s=${f##/*/}
		tar --exclude-from="conf/tar_exclude" -czf  /data/backup/${WIKI_HOST}_${TIMESTAMP}/$s.tar.gz  -C /data/ $s
	fi
	done

|